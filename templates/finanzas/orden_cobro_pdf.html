<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ titulo_doc }}</title>
    {% load humanize %}
    {% load static %}
    <style>
        @page { size: Letter; margin: 1.5cm; }
        body { font-family: 'Helvetica', sans-serif; color: #2D1B4B; font-size: 10pt; margin: 0; }

        /* Estructura */
        .page-border { border: 1px solid #F3F4F6; border-radius: 2rem; padding: 30px; min-height: 95%; position: relative; }
        
        /* Header */
        .header { width: 100%; border-bottom: 2px solid #F3F4F6; padding-bottom: 20px; margin-bottom: 30px; }
        .logo-img { height: 45px; margin-bottom: 5px; }
        .brand-name { font-size: 20pt; font-weight: 900; color: #2D1B4B; margin: 0; }
        .doc-badge { background: #2D1B4B; color: white; padding: 5px 15px; border-radius: 1rem; font-weight: bold; font-size: 9pt; display: inline-block; text-transform: uppercase; }

        /* Info Grid */
        .info-table { width: 100%; margin-bottom: 30px; }
        .info-box { background: #F9FAFB; padding: 15px; border-radius: 1rem; border: 1px solid #eee; }
        .label { font-size: 7pt; font-weight: 800; color: #A855F7; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .value { font-size: 10pt; font-weight: bold; display: block; }
        
        /* Resumen de Pago (La caja importante) */
        .payment-highlight { background: #2D1B4B; color: white; border-radius: 1.5rem; padding: 25px; margin: 20px 0; text-align: center; }
        .pay-amount { font-size: 24pt; font-weight: 900; margin: 10px 0; }
        .pay-concept { font-size: 9pt; opacity: 0.9; font-style: italic; }

        /* Tabla Servicios */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th { background: #F9FAFB; color: #2D1B4B; padding: 10px; text-align: left; font-size: 8pt; font-weight: 800; text-transform: uppercase; border-bottom: 1px solid #eee; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
        
        /* Datos Bancarios */
        .bank-section { margin-top: 30px; border: 1px dashed #A855F7; border-radius: 1rem; padding: 20px; background: #FAF5FF; }
        .bank-title { font-weight: bold; color: #A855F7; margin-bottom: 10px; text-transform: uppercase; font-size: 9pt; }
        
        /* Totales Desglose */
        .totals-table td { text-align: right; padding: 3px 10px; font-size: 9pt; border: none; }
        .total-final { border-top: 2px solid #2D1B4B; font-weight: 900; font-size: 12pt; padding-top: 5px; }

        .footer { position: absolute; bottom: 20px; left: 30px; right: 30px; text-align: center; font-size: 8pt; color: #9CA3AF; border-top: 1px solid #eee; padding-top: 10px; }
    </style>
</head>
<body>
    <div class="page-border">
        
        <table class="header">
            <tr>
                <td style="vertical-align: middle;">
                    {% if base_url %}
                        <img src="{{ base_url }}static/img/logo.png" class="logo-img">
                    {% else %}
                        <img src="{% static 'img/logo.png' %}" class="logo-img">
                    {% endif %}
                    <h1 class="brand-name">CORPAD</h1>
                </td>
                <td style="text-align: right; vertical-align: middle;">
                    <div class="doc-badge">{{ titulo_doc }}</div>
                    <div style="font-size: 8pt; color: #6B7280; margin-top: 5px; font-weight: bold;">
                        Fecha de Emisi贸n: {{ fecha_emision|date:"d/m/Y" }} <br>
                        Ref: {{ cuenta.id|stringformat:"04d" }}
                    </div>
                </td>
            </tr>
        </table>

        <table class="info-table">
            <tr>
                <td width="55%">
                    <div class="info-box">
                        <span class="label">Cliente</span>
                        <span class="value">{{ cuenta.cliente.nombre_empresa|upper }}</span>
                        <span style="font-size: 9pt; color: #555;">{{ cuenta.cliente.nombre_contacto }}</span>
                        <br>
                        <span style="font-size: 8pt; color: #777;">{{ c.prospecto_direccion|default:cuenta.cliente.email }}</span>
                    </div>
                </td>
                <td width="5%"></td>
                <td width="40%">
                    <div class="info-box" style="background: white; border-color: #A855F7;">
                        <span class="label">Proyecto</span>
                        <span class="value">{{ c.titulo|default:cuenta.concepto }}</span>
                        <span style="font-size: 8pt; color: #777;">Cotizaci贸n #{{ c.id }}</span>
                    </div>
                </td>
            </tr>
        </table>

        <div class="payment-highlight">
            <div style="font-size: 10pt; font-weight: bold; opacity: 0.8; text-transform: uppercase;">Monto a pagar en esta exhibici贸n</div>
            <div class="pay-amount">$ {{ monto_a_pagar|floatformat:2|intcomma }} MXN</div>
            <div class="pay-concept">{{ nota }}</div>
        </div>

        <div style="margin-top: 30px;">
            <span class="label" style="margin-bottom: 10px;">Desglose de Servicios (Referencia)</span>
            <table>
                <thead>
                    <tr>
                        <th width="70%">Concepto</th>
                        <th width="30%" style="text-align: right;">Valor Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in c.items.all %}
                    <tr>
                        <td>
                            <strong>{{ item.servicio.nombre }}</strong><br>
                            <span style="color: #666; font-size: 8pt;">{{ item.descripcion_personalizada|default:item.servicio.descripcion }}</span>
                        </td>
                        <td style="text-align: right; font-weight: bold;">$ {{ item.subtotal|floatformat:2|intcomma }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <table width="100%">
            <tr>
                <td width="55%" style="vertical-align: top; border: none; padding: 0;">
                    <div class="bank-section">
                        <div class="bank-title"><i class="fas fa-university"></i> Datos para Transferencia</div>
                        
                        <table style="width: 100%; margin: 0;">
                            <tr>
                                <td style="padding: 2px; border: none; color: #555; font-size: 9pt;">Banco:</td>
                                <td style="padding: 2px; border: none; font-weight: bold;">{{ banco.banco }}</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px; border: none; color: #555; font-size: 9pt;">Beneficiario:</td>
                                <td style="padding: 2px; border: none; font-weight: bold;">{{ banco.titular }}</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px; border: none; color: #555; font-size: 9pt;">No. Cuenta:</td>
                                <td style="padding: 2px; border: none; font-weight: bold;">{{ banco.cuenta }}</td>
                            </tr>
                            <tr>
                                <td style="padding: 2px; border: none; color: #555; font-size: 9pt;">CLABE:</td>
                                <td style="padding: 2px; border: none; font-weight: bold;">{{ banco.clabe }}</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 10px; font-size: 8pt; color: #A855F7; font-style: italic;">
                            * Favor de enviar comprobante al realizar su pago.
                        </div>
                    </div>
                </td>
                <td width="5%" style="border: none;"></td>
                <td width="40%" style="vertical-align: top; border: none; padding: 0;">
                    <table class="totals-table" style="margin-top: 10px;">
                        <tr>
                            <td>Subtotal Proyecto:</td>
                            <td>$ {{ c.subtotal|floatformat:2|intcomma }}</td>
                        </tr>
                        {% if c.descuento > 0 %}
                        <tr>
                            <td style="color: green;">Descuento:</td>
                            <td style="color: green;">- $ {{ c.descuento|floatformat:2|intcomma }}</td>
                        </tr>
                        {% endif %}
                        
                        {% if c.aplica_iva %}
                        <tr>
                            <td>I.V.A. ({{ c.porcentaje_iva|floatformat:0 }}%):</td>
                            <td>$ {{ c.monto_iva|floatformat:2|intcomma }}</td>
                        </tr>
                        <tr>
                            <td class="total-final" style="color: #6B7280;">Total Proyecto:</td>
                            <td class="total-final" style="color: #6B7280;">$ {{ c.total_con_iva|floatformat:2|intcomma }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td class="total-final" style="color: #6B7280;">Total Proyecto:</td>
                            <td class="total-final" style="color: #6B7280;">$ {{ c.total|floatformat:2|intcomma }}</td>
                        </tr>
                        {% endif %}

                        <tr><td colspan="2" style="border-bottom: 1px dashed #ddd; height: 10px;"></td></tr>

                        <tr>
                            <td style="font-weight: bold; color: #2D1B4B; padding-top: 10px;">ESTE PAGO ({{ porcentaje_pago }}%):</td>
                            <td style="font-weight: 900; color: #2D1B4B; font-size: 14pt; padding-top: 10px;">$ {{ monto_a_pagar|floatformat:2|intcomma }}</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <div class="footer">
            Gestiones Corpad | www.corpad.mx <br>
            Documento generado digitalmente. No requiere firma aut贸grafa.
        </div>
    </div>
</body>
</html>